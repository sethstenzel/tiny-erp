<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IndSurp ‚Äî Warehouse Layout</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="warehouse.css">
</head>
<body>

  <!-- ‚îÄ‚îÄ App Header: search + brand ‚îÄ‚îÄ -->
  <header class="app-header">
    <div class="search-bar">
      <div class="search-input-wrap">
        <input type="text" id="search-input" placeholder="Search by Item ID..." autocomplete="off"
               oninput="onSearchInput()" onkeydown="if(event.key==='Enter') runSearch()" />
        <button class="btn-search" onclick="runSearch()">Search</button>
        <button class="btn-clear-search" id="btn-clear" onclick="clearSearch()" style="display:none">Clear</button>
      </div>
      <div class="search-results hidden" id="search-results"></div>
    </div>
    <div class="brand-name">IndSurp</div>
  </header>

  <!-- ‚îÄ‚îÄ Main content ‚îÄ‚îÄ -->
  <main class="app-main">
  <div class="warehouse-panel" id="warehouse-panel">
    <div id="tab-bar" class="tab-bar"></div>
    <div class="viewport" id="viewport">
      <div class="pan-zoom-layer" id="pan-zoom-layer">
        <div class="warehouse-wrapper" id="warehouse-wrapper">
          <div class="warehouse" id="warehouse">
            <div id="draw-preview"></div>
          </div>
          <div class="rh rh-nw" data-edge="nw"></div>
          <div class="rh rh-n"  data-edge="n"></div>
          <div class="rh rh-ne" data-edge="ne"></div>
          <div class="rh rh-e"  data-edge="e"></div>
          <div class="rh rh-se" data-edge="se"></div>
          <div class="rh rh-s"  data-edge="s"></div>
          <div class="rh rh-sw" data-edge="sw"></div>
          <div class="rh rh-w"  data-edge="w"></div>
        </div>
      </div>
    </div>
  </div>
  </main>

  <div class="floating-menu" id="floating-menu">
    <button class="menu-toggle-tab" id="menu-toggle-tab" onclick="toggleMenu()" title="Toggle menu">&#x203A;</button>
    <h3>Warehouse Tools</h3>
    <button class="btn-add-isle" id="btn-add-isle" onclick="activateDrawMode()">Add Isle</button>
    <button class="btn-add-zone" id="btn-add-zone" onclick="activateZoneMode()">Add Zone</button>
    <button class="btn-edit-warehouse" id="btn-edit-warehouse" onclick="activateEditMode()">Edit Warehouse</button>
    <button class="btn-delete-entity" id="btn-delete-entity" onclick="deleteSelectedEntity()" style="display:none">&#x1F5D1; Delete Selected</button>
    <hr style="border:none;border-top:1px solid #eee;margin:4px 0;">
    <button class="btn-save-layout" onclick="exportLayout()">Save Layout</button>
    <button class="btn-load-layout" onclick="triggerImport()">Load Layout</button>
    <button class="btn-add-bg" onclick="triggerBgImport()">Add Background</button>
    <button class="btn-clear-bg" id="btn-clear-bg" onclick="clearBackground()" style="display:none">Clear Background</button>
    <input type="file" id="import-file-input" accept=".json" style="display:none" onchange="handleImportFile(this)">
    <input type="file" id="bg-file-input" accept="image/png,image/jpeg" style="display:none" onchange="handleBgFile(this)">
    <div class="status-msg" id="status">Click "Add Isle" then<br>draw inside the warehouse.</div>
    <div class="isle-count" id="isle-count">Isles: 0</div>
    <div style="display:flex;gap:5px;margin-top:2px;">
      <button onclick="zoomOut()" title="Zoom Out" style="flex:1;padding:7px 4px;border:1px solid #ddd;border-radius:6px;background:#f5f5f5;cursor:pointer;font-size:18px;font-weight:700;color:#555;line-height:1;">‚àí</button>
      <button onclick="resetView()" title="Reset View" style="flex:1;padding:7px 4px;border:1px solid #ddd;border-radius:6px;background:#f5f5f5;cursor:pointer;font-size:13px;font-weight:700;color:#555;line-height:1;">‚åÇ</button>
      <button onclick="zoomIn()" title="Zoom In" style="flex:1;padding:7px 4px;border:1px solid #ddd;border-radius:6px;background:#f5f5f5;cursor:pointer;font-size:18px;font-weight:700;color:#555;line-height:1;">+</button>
    </div>
    <div id="zoom-display" style="font-size:11px;color:#aaa;text-align:center;">100%</div>
  </div>

  <!-- ‚ïê‚ïê CREATION STEP 1: Isle name + shelves per subsection ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-count">
    <div class="modal">
      <button class="modal-close" onclick="cancelIsleCreation()" title="Close">&#x2715;</button>
      <p class="modal-title">New Isle</p>
      <p class="modal-subtitle">Name this isle and set how many shelves each subsection will have.</p>
      <div class="two-col">
        <div class="form-field" style="flex:0 0 80px">
          <label>Row</label>
          <input type="text" id="isle-row-input" placeholder="e.g. A" maxlength="10" />
        </div>
        <div class="form-field">
          <label>Isle Name <span style="color:#e53935">*</span></label>
          <input type="text" id="isle-name-input" placeholder="e.g. Aisle 1, Electronics Row" />
        </div>
      </div>
      <div class="form-field">
        <label>Shelves per Subsection <span style="color:#888;font-weight:400">(max 26)</span></label>
        <input class="shelf-count-input" id="shelf-count-input" type="number" min="1" max="26" value="1" />
      </div>
      <div class="two-col">
        <div class="form-field">
          <label>Isle Border Color</label>
          <div class="color-pick-row">
            <input type="color" id="isle-color-input" oninput="onIsleColorChange(this.value)" />
            <span class="color-pick-hint">Isle border</span>
          </div>
        </div>
        <div class="form-field">
          <label>Isle Name Color</label>
          <div class="color-pick-row">
            <input type="color" id="isle-label-color-input" oninput="onIsleLabelColorChange(this.value)" />
            <span class="color-pick-hint">Name label</span>
          </div>
        </div>
      </div>
      <div class="two-col">
        <div class="form-field">
          <label>Shelf Border Color</label>
          <div class="color-pick-row">
            <input type="color" id="shelf-color-input" value="#aaaaaa" />
            <span class="color-pick-hint">Shelf slot borders</span>
          </div>
        </div>
        <div class="form-field">
          <label>Isle Fill Color</label>
          <div class="color-pick-row">
            <input type="color" id="isle-fill-color" value="#ffffff" oninput="onIsleFillChange()" />
            <span class="color-pick-hint">Inner fill</span>
          </div>
        </div>
      </div>
      <div class="form-field">
        <label>Isle Fill Opacity <span id="isle-fill-opacity-label" style="font-weight:400;color:#888;">0%</span></label>
        <input type="range" id="isle-fill-opacity" min="0" max="100" value="0" oninput="onIsleFillChange()" style="width:100%;margin-top:4px;">
      </div>
      <div class="form-field">
        <label>Isle Facing</label>
        <div class="facing-group">
          <button type="button" class="facing-opt selected" data-value="right" onclick="setFacing('right')">‚Üê Right-facing<br><span style="font-size:10px;font-weight:400;">First shelf on left</span></button>
          <button type="button" class="facing-opt" data-value="left" onclick="setFacing('left')">Left-facing ‚Üí<br><span style="font-size:10px;font-weight:400;">First shelf on right</span></button>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="cancelIsleCreation()">Cancel</button>
        <button class="btn-confirm" onclick="confirmStep1()">Next ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê CREATION STEP 2: Subsection config ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-subsections">
    <div class="modal">
      <button class="modal-close" onclick="cancelIsleCreation()" title="Close">&#x2715;</button>
      <p class="modal-title" id="subsection-config-title">Subsection Setup</p>
      <p class="modal-subtitle">Set how many subsections and where the numbering starts.</p>
      <div class="two-col">
        <div class="form-field">
          <label>Start Number</label>
          <input type="number" id="subsection-start-input" min="1" value="1" />
        </div>
        <div class="form-field">
          <label>Number of Subsections</label>
          <input type="number" id="subsection-count-input" min="1" value="1" />
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="goBackToStep1()">‚Üê Back</button>
        <button class="btn-confirm" onclick="confirmStep2()">Next ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê CREATION STEP 3: Label shelves ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-labels">
    <div class="modal">
      <button class="modal-close" onclick="cancelIsleCreation()" title="Close">&#x2715;</button>
      <p class="modal-title" id="modal-labels-title">Label Shelves</p>
      <p class="modal-subtitle">These labels apply to every subsection in the isle.</p>
      <div class="shelf-list" id="shelf-list"></div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="goBackToStep2()">‚Üê Back</button>
        <button class="btn-confirm" onclick="confirmStep3()">Confirm</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê INTERACTION: Select subsection ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-subsection-select">
    <div class="modal">
      <button class="modal-close" onclick="closeAllModals()" title="Close">&#x2715;</button>
      <p class="modal-title" id="subsection-select-title">Select a Subsection</p>
      <p class="modal-subtitle">Click a subsection to manage its shelves.</p>
      <div class="select-list" id="subsection-select-list"></div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeAllModals()">Close</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê INTERACTION: Select shelf ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-shelf-select">
    <div class="modal">
      <button class="modal-close" onclick="closeAllModals()" title="Close">&#x2715;</button>
      <p class="modal-title" id="shelf-select-title">Select a Shelf</p>
      <p class="modal-subtitle">Click a shelf to manage its items.</p>
      <div class="select-list" id="shelf-select-list"></div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="backToSubsectionSelect()">‚Üê Back</button>
        <button class="btn-confirm" onclick="openAddShelf()">+ Add Shelf</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê INTERACTION: Add shelf ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-add-shelf">
    <div class="modal">
      <button class="modal-close" onclick="closeAllModals()" title="Close">&#x2715;</button>
      <p class="modal-title">Add Shelf</p>
      <p class="modal-subtitle" id="add-shelf-subtitle"></p>
      <div class="form-field">
        <label>Shelf Name <span style="color:#e53935">*</span></label>
        <input type="text" id="add-shelf-name-input" placeholder="e.g. D" />
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="backToShelfSelectFromAdd()">‚Üê Back</button>
        <button class="btn-confirm" onclick="confirmAddShelf()">Add Shelf</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê INTERACTION: Shelf actions ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-shelf-actions">
    <div class="modal">
      <button class="modal-close" onclick="closeAllModals()" title="Close">&#x2715;</button>
      <p class="modal-title" id="shelf-actions-title">Shelf Actions</p>
      <p class="modal-subtitle" id="shelf-actions-subtitle"></p>
      <div class="action-btn-group">
        <button class="action-btn add" onclick="openAddItem()">
          <span class="action-icon">Ôºã</span>Add Item
        </button>
        <button class="action-btn rem" onclick="openRemoveItems()">
          <span class="action-icon">Ôºç</span>Remove Item
        </button>
        <button class="action-btn del" onclick="deleteShelf()">
          <span class="action-icon">üóë</span>Delete Shelf
        </button>
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="backToShelfSelect()">‚Üê Back</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê INTERACTION: Add item ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-add-item">
    <div class="modal">
      <button class="modal-close" onclick="closeAllModals()" title="Close">&#x2715;</button>
      <p class="modal-title">Add Item</p>
      <p class="modal-subtitle" id="add-item-subtitle"></p>
      <div class="form-field">
        <label>Item ID <span style="color:#e53935">*</span></label>
        <input type="text" id="item-id-input" placeholder="e.g. SKU-00123" />
      </div>
      <div class="form-field">
        <label>Item Type</label>
        <input type="text" id="item-type-input" placeholder="e.g. Electronics" />
      </div>
      <div class="form-field">
        <label>Item Category</label>
        <input type="text" id="item-category-input" placeholder="e.g. Accessories" />
      </div>
      <div class="form-field">
        <label>Notes</label>
        <textarea id="item-notes-input" placeholder="Any additional notes..."></textarea>
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="backFromAddItem()">‚Üê Back</button>
        <button class="btn-confirm" onclick="confirmAddItem()">Add Item</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê ZONE: Label modal ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-zone">
    <div class="modal">
      <button class="modal-close" onclick="cancelZoneCreation()" title="Close">&#x2715;</button>
      <p class="modal-title">New Zone</p>
      <p class="modal-subtitle">Label this area of the warehouse.</p>
      <div class="form-field">
        <label>Zone Label <span style="color:#e53935">*</span></label>
        <input type="text" id="zone-label-input" placeholder="e.g. Receiving, Break Room, Staging" />
      </div>
      <div class="two-col">
        <div class="form-field">
          <label>Zone Border Color</label>
          <div class="color-pick-row">
            <input type="color" id="zone-color-input" oninput="onZoneColorChange(this.value)" />
            <span class="color-pick-hint">Border &amp; fill</span>
          </div>
        </div>
        <div class="form-field">
          <label>Zone Name Color</label>
          <div class="color-pick-row">
            <input type="color" id="zone-name-color-input" value="#444444" oninput="onZoneNameColorChange(this.value)" />
            <span class="color-pick-hint">Label text</span>
          </div>
        </div>
      </div>
      <div class="form-field">
        <label>Fill Opacity <span id="zone-fill-opacity-label" style="font-weight:400;color:#888;">18%</span></label>
        <input type="range" id="zone-fill-opacity" min="0" max="100" value="18" oninput="onZoneFillOpacityChange()" style="width:100%;margin-top:4px;">
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="cancelZoneCreation()">Cancel</button>
        <button class="btn-confirm" onclick="confirmZone()">Create Zone</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê INTERACTION: Confirm delete shelf ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-confirm-delete">
    <div class="modal">
      <p class="modal-title">Delete Shelf?</p>
      <p class="modal-subtitle" id="confirm-delete-msg"></p>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="hide('modal-confirm-delete')">No, Keep It</button>
        <button class="btn-danger" onclick="confirmDeleteShelf()">Yes, Delete</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê COPY/PASTE: Paste isle name ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-paste-isle">
    <div class="modal">
      <button class="modal-close" onclick="cancelPaste()" title="Close">&#x2715;</button>
      <p class="modal-title">Paste Isle</p>
      <p class="modal-subtitle" id="paste-isle-subtitle">All settings and structure will be copied. Items will not be copied.</p>
      <div class="form-field">
        <label>New Isle Name <span style="color:#e53935">*</span></label>
        <input type="text" id="paste-isle-name" placeholder="Enter a name for the pasted isle" />
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="cancelPaste()">Cancel</button>
        <button class="btn-confirm" onclick="pasteIsle()">Paste</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê EDIT MODE: Delete isle / zone ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-delete-entity">
    <div class="modal">
      <p class="modal-title" id="delete-entity-title">Delete?</p>
      <p class="modal-subtitle" id="delete-entity-msg"></p>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="hide('modal-delete-entity')">Cancel</button>
        <button class="btn-danger" onclick="confirmDeleteEntity()">Yes, Delete</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê CONFIRM: Load layout ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-confirm-import">
    <div class="modal">
      <p class="modal-title">Load Layout?</p>
      <p class="modal-subtitle">This will replace all warehouse tabs with the loaded layout. All unsaved changes will be lost.</p>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="hide('modal-confirm-import')">Cancel</button>
        <button class="btn-danger" onclick="confirmImport()">Yes, Load</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê INTERACTION: Remove items ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-remove-items">
    <div class="modal">
      <button class="modal-close" onclick="closeAllModals()" title="Close">&#x2715;</button>
      <p class="modal-title" id="remove-items-title">Remove Items</p>
      <p class="modal-subtitle">Click to select ¬∑ Ctrl+Click for multiple</p>
      <div class="item-list" id="item-list"></div>
      <div class="selected-count" id="selected-count">0 selected</div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="backToShelfActions()">‚Üê Back</button>
        <button class="btn-danger" id="btn-remove-confirm" onclick="confirmRemoveItems()">Remove Selected</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê ZONE: Item actions modal ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-zone-actions">
    <div class="modal">
      <button class="modal-close" onclick="closeAllModals()" title="Close">&#x2715;</button>
      <p class="modal-title" id="zone-actions-title">Zone</p>
      <p class="modal-subtitle" id="zone-actions-subtitle"></p>
      <div class="action-btn-group">
        <button class="action-btn add" onclick="openAddZoneItem()">
          <span class="action-icon">Ôºã</span>Add Item
        </button>
        <button class="action-btn rem" onclick="openZoneItemList()">
          <span class="action-icon">&#x2261;</span>Manage Items
        </button>
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeAllModals()">Close</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê ZONE: Manage items modal ‚ïê‚ïê -->
  <div class="modal-overlay hidden" id="modal-zone-items">
    <div class="modal">
      <button class="modal-close" onclick="closeAllModals()" title="Close">&#x2715;</button>
      <p class="modal-title" id="zone-items-title">Zone Items</p>
      <p class="modal-subtitle">Click to select ¬∑ Ctrl+Click for multiple</p>
      <div class="item-list" id="zone-item-list"></div>
      <div class="selected-count" id="zone-selected-count">0 selected</div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="backToZoneActions()">‚Üê Back</button>
        <button class="btn-danger" id="btn-zone-remove-confirm" onclick="confirmRemoveZoneItems()">Remove Selected</button>
      </div>
    </div>
  </div>

  <script src="warehouse.js"></script>

</body>
</html>
